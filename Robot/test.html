<!DOCTYPE HTML>
<html>

<head>
  <style>
    #tissue {
      position: relative;
      cursor: pointer;
    }
    img#tissue {
      top: 200px;
      left: 300px;
    }
  </style>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script> 
  <script>
    const TOPIC = "tissue";
    var client = false;
    
    function onConnect() {
            // 確認連接後，才能訂閱主題
            // console.log("onConnect then subscribe topic");
            // client.subscribe(TOPIC + "#");
    } 
    
    // 收到訊息時...
    function onMessageArrived(message) {
        console.log("onMessageArrived:"+message.payloadString);
        document.getElementById("mqtt_monitor").innerHTML = message.payloadString;
    }
    
    // 發佈訊息
    function publish_message() {
        var payload = "hi";
        var message = new Paho.MQTT.Message(payload);
        message.destinationName = TOPIC;
        client.send(message);
    }
    
    function init() {
        document.getElementById("tissue").addEventListener('click', publish_message);
        // 建立 MQTT 用戶端實體. 你必須正確寫上你設置的埠號.
        // ClientId 可以自行指定，提供 MQTT broker 認證用
        client = new Paho.MQTT.Client("ws://140.119.164.157:9001/", "myClientId");
    
        // 指定收到訊息時的處理動作
        client.onMessageArrived = onMessageArrived;
    
        // 連接 MQTT broker
        client.connect({onSuccess:onConnect});
    }
    
    window.addEventListener('load', init, false);
    //document.addEventListener('DOMContentLoaded', init, false);
  </script>
</head>

<body>

  <img id="tissue" src="./tissues.png">


  <script>
    tissue.onclick = function() {
      let start = Date.now();
      
      let pos = 0;
      if(parseInt(tissue.style.left) === 700 )
        pos = 1;

      let timer = setInterval(function() {
        let timePassed = Date.now() - start;

        if(pos)        
            tissue.style.left = 700 - timePassed / 5 + 'px';
        else
            tissue.style.left = 300 + timePassed / 5 + 'px';

        if (timePassed > 2000) clearInterval(timer);

      }, 20);
    }
  </script>


</body>

</html>